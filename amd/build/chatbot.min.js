define([],function(){return{init:function(){document.querySelector(".chat-body"),document.querySelector(".message-input"),document.querySelector("#send-message"),document.querySelector("#file-input"),document.querySelector(".file-upload-wrapper").querySelector("#file-cancel"),document.querySelector("#chatbot-toggler"),document.querySelector("#close-chatbot")}}});let API_KEY="AIzaSyCQXdM8mF1o7j7KlC2ue75X37ZIU_cDTVk",API_URL="https://generativelanguage.googleapis.com/v1/models/gemini-1.5-pro:generateContent?key="+API_KEY,userData={message:null,file:{data:null,mime_type:null}},chatHistory=[],initialInputHeight=messageInput.scrollHeight,generateBotResponse=async e=>{var t=e.querySelector(".message-text"),a=(chatHistory.push({role:"user",parts:[{text:userData.message},...userData.file.data?[{inline_data:userData.file}]:[]]}),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:chatHistory})});try{var s=await fetch(API_URL,a),i=await s.json();if(!s.ok)throw new Error(i.error.message);var o=i.candidates[0].content.parts[0].text.replace(/\*\*(.*?)\*\*/g,"$1").trim();t.innerText=o,chatHistory.push({role:"model",parts:[{text:o}]})}catch(e){console.log(e),t.innerText=e.message,t.style.color="#ff0000"}finally{userData.file={},e.classList.remove("thinking"),chatBody.scrollTo({top:chatBody.scrollHeight,behavior:"smooth"})}},handleOutgoingMessage=e=>{e.preventDefault(),userData.message=messageInput.value.trim(),messageInput.value="",messageInput.dispatchEvent(new Event("input")),fileUploadWrapper.classList.remove("file-uploaded");e=`<div class="message-text"></div>
                          `+(userData.file.data?`<img src="data:${userData.file.mime_type};base64,${userData.file.data}" class="attachment" />`:""),e=createMessageElement(e,"user-message");e.querySelector(".message-text").innerText=userData.message,chatBody.appendChild(e),chatBody.scrollTo({top:chatBody.scrollHeight,behavior:"smooth"}),setTimeout(()=>{var e=createMessageElement(`<img class="bot-avatar" src="robotic.png" alt="Chatbot Logo" width="50" height="50">
          </img>
          <div class="message-text">
            <div class="thinking-indicator">
              <div class="dot"></div>
              <div class="dot"></div>
              <div class="dot"></div>
            </div>
          </div>`,"bot-message","thinking");chatBody.appendChild(e),chatBody.scrollTo({top:chatBody.scrollHeight,behavior:"smooth"}),generateBotResponse(e)},600)},picker=(messageInput.addEventListener("input",()=>{messageInput.style.height=initialInputHeight+"px",messageInput.style.height=messageInput.scrollHeight+"px",document.querySelector(".chat-form").style.borderRadius=messageInput.scrollHeight>initialInputHeight?"15px":"32px"}),messageInput.addEventListener("keydown",e=>{var t=e.target.value.trim();"Enter"===e.key&&!e.shiftKey&&t&&768<window.innerWidth&&handleOutgoingMessage(e)}),fileInput.addEventListener("change",()=>{let t=fileInput.files[0];var e;t&&((e=new FileReader).onload=e=>{fileInput.value="",fileUploadWrapper.querySelector("img").src=e.target.result,fileUploadWrapper.classList.add("file-uploaded");e=e.target.result.split(",")[1];userData.file={data:e,mime_type:t.type}},e.readAsDataURL(t))}),fileCancelButton.addEventListener("click",()=>{userData.file={},fileUploadWrapper.classList.remove("file-uploaded")}),new EmojiMart.Picker({theme:"light",skinTonePosition:"none",previewPosition:"none",onEmojiSelect:e=>{var{selectionStart:t,selectionEnd:a}=messageInput;messageInput.setRangeText(e.native,t,a,"end"),messageInput.focus()},onClickOutside:e=>{"emoji-picker"===e.target.id?document.body.classList.toggle("show-emoji-picker"):document.body.classList.remove("show-emoji-picker")}}));document.querySelector(".chat-form").appendChild(picker),sendMessage.addEventListener("click",e=>handleOutgoingMessage(e)),document.querySelector("#file-upload").addEventListener("click",()=>fileInput.click()),closeChatbot.addEventListener("click",()=>document.body.classList.remove("show-chatbot")),chatbotToggler.addEventListener("click",()=>document.body.classList.toggle("show-chatbot"));